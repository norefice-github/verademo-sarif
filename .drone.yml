kind: pipeline
type: docker
name: default

steps:
- name: Build with Maven
  image: maven:3-jdk-10
  commands:
  - mvn -B package --file pom.xml
   
- name: Download pipeline code
  image: maven:3-jdk-10
  commands: 
  - curl -O https://downloads.veracode.com/securityscan/pipeline-scan-LATEST.zip
  - unzip pipeline-scan-LATEST.zip pipeline-scan.jar
  
- name: Pipeline Scan
  image: maven:3-jdk-10
  commands:
  - java -jar pipeline-scan.jar --veracode_api_id $VERACODE_API_ID --veracode_api_key $VERACODE_API_SECRET --file "target/verademo.war"
  environment:
      VERACODE_API_ID:
        from_secret: VERACODE_API_ID
      VERACODE_API_SECRET:
        from_secret: VERACODE_API_SECRET
